<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Nini - 2 A√±os y 2 Meses üíñ</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff3366;
            --secondary: #ff85a2;
            --dark: #2c1a25;
            --glass: rgba(255, 255, 255, 0.95);
            --glass-player: rgba(255, 255, 255, 0.85);
            --shadow: 0 10px 30px rgba(255, 51, 102, 0.2);
            --bg-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #feada6 100%);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gradient);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .dancing-font { font-family: 'Dancing Script', cursive; }

        /* --- PANTALLA DE LOGIN --- */
        .login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom right, #ff758c, #ff7eb3);
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.8s ease;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 2.5rem; border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            text-align: center; width: 90%; max-width: 350px;
        }
        .login-hidden { opacity: 0; visibility: hidden; transform: scale(1.2); }

        /* --- CONTADOR --- */
        .time-wrapper {
            background: var(--glass);
            padding: 15px; border-radius: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }
        .time-box {
            text-align: center; min-width: 65px;
            position: relative;
        }
        .time-val { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: block; line-height: 1.1; }
        .time-label { font-size: 0.7rem; text-transform: uppercase; font-weight: 600; color: #777; }

        /* --- CARRUSEL CORREGIDO (SOLUCI√ìN DEFINITIVA) --- */
        .carousel-container-custom {
            position: relative;
            background: rgba(0,0,0,0.05); /* Sutil fondo */
            border-radius: 25px;
            padding: 10px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .carousel-inner {
            height: 60vh; /* Altura fija */
            min-height: 400px;
            border-radius: 20px;
            background: black; /* Fondo negro para resaltar foto */
            overflow: hidden;
        }

        .carousel-item {
            height: 100%; /* Ocupa todo el alto */
            width: 100%;
        }

        /* Wrapper m√°gico para centrar */
        .img-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center; /* Centrado horizontal */
            align-items: center;     /* Centrado vertical */
            padding-bottom: 50px;    /* ESPACIO PARA QUE EL TEXTO NO TAPE LA FOTO */
            background: radial-gradient(circle, #333 0%, #000 100%);
        }

        .carousel-item img {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain; /* Mantiene proporci√≥n sin estirar */
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .custom-caption {
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary);
            border-radius: 15px;
            padding: 10px 20px;
            bottom: 15px;
            left: 5%; right: 5%; width: 90%; /* Centrado y no muy ancho */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .custom-caption p { margin: 0; font-size: 1.1rem; }

        /* --- REPRODUCTOR PREMIUM RESPONSIVE --- */
        .player-card {
            background: var(--glass-player);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.6);
            margin-top: -20px; /* Superposici√≥n ligera est√©tica */
            position: relative;
            z-index: 10;
        }

        .control-btn {
            border: none; background: transparent;
            color: #555; transition: all 0.2s;
            width: 45px; height: 45px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%;
        }
        .control-btn:active { transform: scale(0.9); }
        .control-btn.active { color: var(--primary); background: rgba(255, 51, 102, 0.1); }
        
        .play-btn {
            width: 65px; height: 65px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(255, 51, 102, 0.4);
            font-size: 1.5rem;
        }
        
        /* Barra de volumen rosa personalizada */
        input[type=range] {
            accent-color: var(--primary);
            height: 5px;
        }

        /* --- CARTA Y OTROS --- */
        .letter-box {
            background: #fff;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
            display: none; /* Oculto por defecto */
            border: 2px dashed var(--secondary);
        }

        .floating-emoji {
            position: fixed; pointer-events: none; z-index: 1000;
            animation: floatUp linear forwards;
        }
        @keyframes floatUp {
            to { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* Ajustes M√≥viles */
        @media (max-width: 768px) {
            header h1 { font-size: 2.2rem; }
            .carousel-inner { height: 50vh; min-height: 350px; }
            .custom-caption { padding: 8px; bottom: 10px; }
            .custom-caption p { font-size: 0.95rem; }
            .player-card { padding: 15px; }
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-overlay">
        <div class="login-card">
            <div class="mb-3"><i class="fas fa-heart text-danger fa-3x fa-beat"></i></div>
            <h2 class="dancing-font mb-2 fw-bold" style="color: var(--primary);">Hola, Nini</h2>
            <p class="text-muted small mb-4">Ingresa nuestra fecha (DDMM):</p>
            
            <div class="d-flex justify-content-center gap-2 mb-3">
                <input type="password" id="passInput" class="form-control text-center fw-bold fs-4" 
                       style="width: 120px; border-radius: 15px; color: var(--primary); letter-spacing: 4px;" 
                       placeholder="****" maxlength="4" inputmode="numeric">
                <button id="btnLogin" class="btn btn-danger rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <p id="errorMsg" class="text-danger small fw-bold" style="display:none;">¬°Fecha incorrecta amor! üò¢</p>
        </div>
    </div>

    <main class="container py-3" id="mainContent" style="display:none; opacity:0; transition: opacity 1s;">
        
        <header class="text-center py-3">
            <h1 class="dancing-font fw-bold text-white mb-0" style="text-shadow: 2px 2px 10px rgba(0,0,0,0.2);">
                2 A√±os y 2 Meses
            </h1>
            <p class="text-white opacity-75">Feliz Aniversario mi amor üíñ</p>
        </header>

        <div class="time-wrapper d-flex justify-content-around align-items-center" id="contador">
            </div>

        <div class="col-md-8 mx-auto mb-5">
            <div class="player-card text-center">
                <h6 class="text-uppercase text-muted small fw-bold mb-3 ls-1">
                    <i class="fas fa-compact-disc fa-spin me-2 text-danger"></i>Playlist de Amor
                </h6>
                <h5 id="songTitle" class="fw-bold text-dark mb-4 text-truncate px-3">
                    Cargando m√∫sica...
                </h5>
                
                <audio id="audioPlayer"></audio>

                <div class="d-flex justify-content-center align-items-center gap-2 gap-md-4 mb-4">
                    <button class="control-btn" id="btnShuffle" title="Aleatorio"><i class="fas fa-random"></i></button>
                    <button class="control-btn" id="btnPrev"><i class="fas fa-step-backward fa-lg"></i></button>
                    
                    <button class="play-btn d-flex align-items-center justify-content-center" id="btnPlayPause">
                        <i class="fas fa-play" style="margin-left: 4px;"></i>
                    </button>
                    
                    <button class="control-btn" id="btnNext"><i class="fas fa-step-forward fa-lg"></i></button>
                    <button class="control-btn" id="btnRepeat" title="Repetir"><i class="fas fa-redo"></i></button>
                </div>

                <div class="d-flex align-items-center justify-content-center gap-3 px-4">
                    <i class="fas fa-volume-down text-muted small"></i>
                    <input type="range" class="form-range" id="volumeSlider" min="0" max="1" step="0.05" value="0.8">
                    <i class="fas fa-volume-up text-muted small"></i>
                </div>
            </div>
        </div>

        <section class="col-md-10 mx-auto mb-5">
            <div class="carousel-container-custom">
                <div id="mainCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
                    <div class="carousel-inner" id="carouselTracks">
                        </div>
                    
                    <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>

                    <div class="carousel-caption d-none d-md-block custom-caption">
                        <p id="pcPhrase" class="dancing-font fw-bold">Cargando...</p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-3 d-md-none">
                <div class="bg-white rounded-pill px-4 py-2 shadow-sm d-inline-block border border-danger border-opacity-25">
                    <p id="mobilePhrase" class="mb-0 dancing-font fw-bold text-danger fs-5">Cargando...</p>
                </div>
            </div>
        </section>

        <section class="text-center pb-5">
            <button id="btnShowLetter" class="btn btn-light btn-lg rounded-pill px-5 shadow fw-bold text-danger mb-4">
                <i class="fas fa-envelope me-2"></i>Leer Carta üíå
            </button>

            <div id="theLetter" class="letter-box text-start mx-auto col-md-8">
                <div class="text-center mb-4">
                    <h2 class="dancing-font text-danger fw-bold display-6">Para mi amada Nini üåπ</h2>
                    <small class="text-muted">15 de Febrero, 2026</small>
                </div>
                <div class="fs-5 lh-lg" style="color: #444;">
                    <p>¬°Felices 2 a√±os y 2 meses, mi amor!</p>
                    <p>Parece que fue ayer, aquel <strong>15 de diciembre de 2023</strong>, cuando empezamos este camino juntos. Has llenado mis d√≠as de una luz que no conoc√≠a.</p>
                    <p>Gracias por ser mi mejor amiga, mi c√≥mplice y el amor de mi vida. Adoro cada momento contigo, desde los d√≠as tranquilos hasta nuestras locuras. Eres perfecta para m√≠.</p>
                    <p>Te amo con todo mi coraz√≥n y estoy emocionado por todo lo que nos falta vivir.</p>
                </div>
                <div class="text-end mt-4">
                    <p class="dancing-font fs-3 text-danger fw-bold">Tu Til√≠n, Pedrito. ‚ù§Ô∏è</p>
                </div>
            </div>

            <br>
            <button id="btnMagic" class="btn btn-danger btn-lg rounded-pill px-5 py-3 shadow-lg mt-3 fw-bold">
                ¬°Enviarme Amor! üòò‚ú®
            </button>
        </section>

    </main>
    
    <footer class="text-center text-white py-4 opacity-75 small">
        &copy; 2026 Pedrito & Nini - Amor Eterno ‚ù§Ô∏è
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- CONFIGURACI√ìN ---
            const DATA = {
                start: new Date('2023-12-15T00:00:00'),
                totalPhotos: 100, // 100 Fotos
                totalSongs: 30,   // 30 Canciones
                phrases: [
                    "Eres mi persona favorita en el mundo.", "Contigo todo es m√°s bonito.",
                    "2 a√±os y 2 meses de pura felicidad.", "Tu sonrisa es mi motor.",
                    "Gracias por tanto amor, Nini.", "Eres mi sue√±o hecho realidad.",
                    "Te amo m√°s de lo que las palabras dicen.", "Siempre juntos, mi amor.",
                    "Eres la casualidad m√°s bonita.", "Por mil a√±os m√°s a tu lado."
                ]
            };

            // --- 1. CONTADOR DE TIEMPO ---
            function updateTimer() {
                const now = new Date();
                const diff = now - DATA.start;
                
                // Calculo preciso de fechas
                let years = now.getFullYear() - DATA.start.getFullYear();
                let months = now.getMonth() - DATA.start.getMonth();
                let days = now.getDate() - DATA.start.getDate();

                if (days < 0) {
                    months--;
                    const lastMonth = new Date(now.getFullYear(), now.getMonth(), 0);
                    days += lastMonth.getDate();
                }
                if (months < 0) {
                    years--;
                    months += 12;
                }

                // Horas minutos segundos
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const mins = Math.floor((diff / (1000 * 60)) % 60);
                const secs = Math.floor((diff / 1000) % 60);

                const html = `
                    <div class="time-box"><span class="time-val">${years}</span><span class="time-label">A√±os</span></div>
                    <div class="time-box"><span class="time-val">${months}</span><span class="time-label">Meses</span></div>
                    <div class="time-box"><span class="time-val">${days}</span><span class="time-label">D√≠as</span></div>
                    <div class="time-box d-none d-sm-block"><span class="time-val">${hours}</span><span class="time-label">Hrs</span></div>
                    <div class="time-box d-none d-sm-block"><span class="time-val">${mins}</span><span class="time-label">Min</span></div>
                    <div class="time-box"><span class="time-val">${secs}</span><span class="time-label">Seg</span></div>
                `;
                document.getElementById('contador').innerHTML = html;
            }
            setInterval(updateTimer, 1000);
            updateTimer();

            // --- 2. SISTEMA DE AUDIO ROBUSTO ---
            const audio = document.getElementById('audioPlayer');
            const songs = Array.from({length: DATA.totalSongs}, (_, i) => `audio/cancion${i+1}.mp3`);
            let currentIdx = 0;
            let isShuffle = false;
            let isRepeat = false;

            // UI Elements
            const btnPlay = document.getElementById('btnPlayPause');
            const btnShuffle = document.getElementById('btnShuffle');
            const btnRepeat = document.getElementById('btnRepeat');
            const titleDisplay = document.getElementById('songTitle');

            function loadTrack(idx) {
                currentIdx = idx;
                audio.src = songs[currentIdx];
                audio.load();
                titleDisplay.textContent = `üéµ Reproduciendo: Canci√≥n ${currentIdx + 1}`;
                updatePlayIcon(false); // Reset icon until playing
            }

            function updatePlayIcon(playing) {
                const icon = btnPlay.querySelector('i');
                if(playing) {
                    icon.className = 'fas fa-pause';
                    icon.style.marginLeft = '0';
                } else {
                    icon.className = 'fas fa-play';
                    icon.style.marginLeft = '4px'; // Ajuste visual √≥ptico
                }
            }

            // Play/Pause
            btnPlay.onclick = () => {
                if(!audio.src) loadTrack(0);
                if(audio.paused) {
                    audio.play().then(() => updatePlayIcon(true)).catch(e => console.log("Interacci√≥n requerida"));
                } else {
                    audio.pause();
                    updatePlayIcon(false);
                }
            };

            // Next / Prev Logic
            const nextTrack = () => {
                let nextIndex;
                if(isRepeat) {
                    nextIndex = currentIdx; // Repite la misma
                    audio.currentTime = 0;
                } else if(isShuffle) {
                    // Random distinto al actual
                    do { nextIndex = Math.floor(Math.random() * songs.length); } 
                    while (nextIndex === currentIdx && songs.length > 1);
                } else {
                    nextIndex = (currentIdx + 1) % songs.length;
                }
                loadTrack(nextIndex);
                audio.play().then(() => updatePlayIcon(true));
            };

            document.getElementById('btnNext').onclick = nextTrack;
            
            document.getElementById('btnPrev').onclick = () => {
                if(audio.currentTime > 3) {
                    audio.currentTime = 0;
                } else {
                    let prev = (currentIdx - 1 + songs.length) % songs.length;
                    loadTrack(prev);
                    audio.play().then(() => updatePlayIcon(true));
                }
            };

            // Evento Fin de Canci√≥n
            audio.onended = nextTrack;

            // Botones Extra
            btnShuffle.onclick = () => {
                isShuffle = !isShuffle;
                btnShuffle.classList.toggle('active');
            };
            btnRepeat.onclick = () => {
                isRepeat = !isRepeat;
                btnRepeat.classList.toggle('active');
            };
            
            document.getElementById('volumeSlider').oninput = (e) => audio.volume = e.target.value;

            // --- 3. CARRUSEL DE FOTOS (CENTRADAS) ---
            const trackContainer = document.getElementById('carouselTracks');
            const photoIndices = Array.from({length: DATA.totalPhotos}, (_, i) => i + 1).sort(() => Math.random() - 0.5);

            photoIndices.forEach((num, i) => {
                const item = document.createElement('div');
                item.className = `carousel-item ${i === 0 ? 'active' : ''}`;
                
                // Aqu√≠ est√° la magia del centrado: .img-wrapper
                // loading="lazy" para rendimiento (salvo las primeras 2)
                const loading = i < 2 ? "eager" : "lazy";
                
                item.innerHTML = `
                    <div class="img-wrapper">
                        <img src="./img/photo${num}.jpg" 
                             alt="Recuerdo ${num}" 
                             loading="${loading}"
                             onerror="this.src='https://via.placeholder.com/400x600?text=Foto+No+Encontrada'">
                    </div>
                `;
                trackContainer.appendChild(item);
            });

            // Actualizar frases
            const updatePhrases = () => {
                // Usamos el √≠ndice de la diapositiva actual para elegir frase
                // Pero como es aleatorio, simplemente rotamos frases
                const activeIdx = Array.from(trackContainer.children).findIndex(c => c.classList.contains('active'));
                const phrase = DATA.phrases[activeIdx % DATA.phrases.length];
                document.getElementById('pcPhrase').textContent = phrase;
                document.getElementById('mobilePhrase').textContent = phrase;
            };

            document.getElementById('mainCarousel').addEventListener('slide.bs.carousel', () => {
                // Peque√±o delay para que cambie el texto al iniciar la transici√≥n
                setTimeout(updatePhrases, 100);
            });
            updatePhrases(); // Init

            // --- 4. LOGIN SYSTEM ---
            const btnLogin = document.getElementById('btnLogin');
            const inputPass = document.getElementById('passInput');
            const screen = document.getElementById('loginScreen');
            const main = document.getElementById('mainContent');

            function doLogin() {
                if(inputPass.value === "1512") {
                    screen.classList.add('login-hidden');
                    setTimeout(() => {
                        screen.remove();
                        main.style.display = 'block';
                        setTimeout(() => main.style.opacity = 1, 100);
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                        // Intentar reproducir m√∫sica
                        loadTrack(0);
                        audio.play().then(() => updatePlayIcon(true)).catch(e=>console.log("Autoplay bloqueado"));
                    }, 800);
                } else {
                    document.getElementById('errorMsg').style.display = 'block';
                    inputPass.value = '';
                    if(navigator.vibrate) navigator.vibrate([200, 50, 200]);
                }
            }

            btnLogin.onclick = doLogin;
            inputPass.onkeyup = (e) => { if(e.key === 'Enter') doLogin(); };

            // --- 5. INTERACCIONES EXTRA ---
            document.getElementById('btnShowLetter').onclick = function() {
                const box = document.getElementById('theLetter');
                if(getComputedStyle(box).display === 'none') {
                    box.style.display = 'block';
                    this.innerHTML = '<i class="fas fa-eye-slash me-2"></i>Ocultar Carta';
                    box.scrollIntoView({ behavior: 'smooth' });
                } else {
                    box.style.display = 'none';
                    this.innerHTML = '<i class="fas fa-envelope me-2"></i>Leer Carta üíå';
                }
            };

            document.getElementById('btnMagic').onclick = () => {
                // Confeti
                confetti({
                    particleCount: 100, spread: 100, origin: { y: 0.6 },
                    colors: ['#ff3366', '#ffffff']
                });
                
                // Emojis flotantes
                for(let i=0; i<15; i++) {
                    const el = document.createElement('div');
                    el.classList.add('floating-emoji');
                    el.textContent = ['üòò','üíñ','üíã','üòª'][Math.floor(Math.random()*4)];
                    el.style.left = Math.random()*100 + 'vw';
                    el.style.bottom = '-50px';
                    el.style.fontSize = (Math.random()*30 + 20) + 'px';
                    el.style.animationDuration = (Math.random()*3 + 2) + 's';
                    document.body.appendChild(el);
                    setTimeout(() => el.remove(), 5000);
                }
            };
        });
    </script>
</body>
</html>
