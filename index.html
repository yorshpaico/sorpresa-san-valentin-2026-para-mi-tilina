<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Nini - 2 A√±os y 2 Meses üíñ</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff4d6d;
            --secondary: #ff758c;
            --accent: #ff0080;
            --dark: #2d3142;
            --glass: rgba(255, 255, 255, 0.92);
            --glass-dark: rgba(0, 0, 0, 0.6);
            --shadow: 0 15px 45px rgba(255, 0, 128, 0.35);
            --bg-gradient: linear-gradient(-45deg, #ff4e50, #f9d423, #ff0080, #7928ca);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--bg-gradient);
            background-size: 400% 400%;
            animation: gradientAnimation 12s ease infinite;
            min-height: 100vh;
            color: var(--dark);
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .dancing-font { font-family: 'Dancing Script', cursive; }

        /* PANTALLA DE LOGIN */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-gradient);
            background-size: 400% 400%;
            animation: gradientAnimation 8s ease infinite;
            z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s;
        }

        .login-content {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px; width: 85%;
            text-align: center;
        }

        .login-hidden { opacity: 0; visibility: hidden; pointer-events: none; transform: scale(1.1); }

        /* CONTADOR */
        .time-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            text-align: center;
            min-width: 80px;
            border-bottom: 4px solid var(--primary);
            transition: transform 0.3s ease;
        }
        .time-box:hover { transform: translateY(-5px); }
        .time-val { display: block; font-size: 1.8rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .time-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: #6c757d; font-weight: 600; margin-top: 5px; }

        /* CARRUSEL */
        .carousel-inner {
            border-radius: 25px;
            background: var(--glass-dark);
            height: 60vh;
            min-height: 400px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        .carousel-item { height: 100%; display: flex; align-items: center; justify-content: center; }
        .carousel-item img { max-height: 100%; max-width: 100%; object-fit: contain; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5)); }
        .custom-caption {
            background: rgba(255, 255, 255, 0.95);
            color: var(--primary);
            border-radius: 50px;
            padding: 10px 30px;
            bottom: 20px;
            font-weight: 600;
        }

        /* ELEMENTOS FLOTANTES */
        .floating-element {
            position: fixed; pointer-events: none; z-index: 100;
            animation: floatAnimation linear forwards;
            font-family: "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
        }
        @keyframes floatAnimation {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        /* REPRODUCTOR */
        .music-player {
            background: var(--glass);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        /* Estado activo de botones */
        .btn-active-control {
            background-color: var(--primary) !important;
            color: white !important;
            border-color: var(--primary) !important;
            box-shadow: 0 0 10px rgba(255, 77, 109, 0.5);
        }

        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 77, 109, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(255, 77, 109, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 77, 109, 0); }
        }

        @media (max-width: 768px) {
            header h1 { font-size: 2.5rem; }
            .carousel-inner { height: 50vh; min-height: 300px; }
            .time-box { min-width: 60px; padding: 8px; margin-bottom: 5px; }
            .time-val { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-overlay">
        <div class="login-content">
            <div class="mb-3"><span style="font-size: 4rem;" class="pulse-animation">üîí</span></div>
            <h2 class="mb-2 fw-bold dancing-font" style="color: var(--primary); font-size: 2.8rem;">Hola, Nini</h2>
            <p class="mb-4 text-muted small">Ingresa nuestra fecha especial (DDMM):</p>
            <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
                <input type="password" id="passwordInput" class="form-control text-center fs-3 fw-bold" 
                       style="max-width: 140px; border-radius: 15px; letter-spacing: 5px; color: var(--primary);" 
                       placeholder="****" maxlength="4" autocomplete="new-password" inputmode="numeric">
                <button id="loginBtn" class="btn btn-danger btn-lg rounded-circle shadow pulse-animation" style="width: 50px; height: 50px; padding: 0;">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
            <p id="errorMsg" class="text-danger fw-bold small" style="display:none;">Fecha incorrecta, intenta de nuevo.</p>
        </div>
    </div>

    <main class="container py-3" style="display:none; opacity:0; transition: opacity 1s;" id="mainContent">
        <header class="text-center py-4">
            <h1 class="display-4 fw-bold text-white dancing-font" style="text-shadow: 3px 3px 10px rgba(0,0,0,0.3);">
                Felices 2 A√±os y 2 Meses üíñ
            </h1>
        </header>

        <section class="mb-5">
            <div id="contador-amor" class="d-flex justify-content-center flex-wrap gap-2 gap-md-3"></div>
        </section>

        <section id="musica" class="mb-5">
            <div class="music-player text-center p-3 mx-auto" style="max-width: 600px;">
                <h6 id="songTitle" class="mb-3 text-secondary fw-bold small text-uppercase ls-1">
                    <i class="fas fa-music me-2"></i>Nuestra Playlist
                </h6>
                <audio id="backgroundMusic"></audio>
                
                <div class="controls d-flex justify-content-center align-items-center gap-3 mb-3 flex-wrap">
                    <button id="shuffleButton" class="btn btn-outline-secondary btn-sm rounded-circle p-2" title="Aleatorio">
                        <i class="fas fa-random"></i>
                    </button>
                    
                    <button id="prevButton" class="btn btn-outline-secondary btn-sm rounded-circle p-2"><i class="fas fa-step-backward"></i></button>
                    <button id="playPauseButton" class="btn btn-danger btn-lg rounded-circle shadow pulse-animation" style="width: 60px; height: 60px;">
                        <i class="fas fa-play"></i>
                    </button>
                    <button id="nextButton" class="btn btn-outline-secondary btn-sm rounded-circle p-2"><i class="fas fa-step-forward"></i></button>
                    
                    <button id="repeatButton" class="btn btn-outline-secondary btn-sm rounded-circle p-2" title="Repetir Canci√≥n">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
                
                <div class="d-flex align-items-center justify-content-center gap-2 px-4">
                    <i class="fas fa-volume-down text-muted small"></i>
                    <input type="range" class="form-range" id="volumeControl" min="0" max="1" step="0.01" value="0.7">
                    <i class="fas fa-volume-up text-muted small"></i>
                </div>
            </div>
        </section>

        <section id="carrusel" class="mb-5">
            <div id="photoCarousel" class="carousel slide carousel-fade shadow-lg rounded-4 overflow-hidden" data-bs-ride="carousel">
                <div class="carousel-inner" id="carouselContainer"></div>
                <div class="carousel-caption d-none d-md-block custom-caption">
                    <p id="carouselPhrase" class="h5 mb-0 dancing-font">Cargando recuerdos...</p>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#photoCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#photoCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>
            <div class="text-center mt-3 d-md-none">
                <div class="bg-white bg-opacity-75 rounded-pill py-2 px-3 shadow-sm d-inline-block">
                    <p class="mb-0 dancing-font fs-4 text-danger fw-bold" id="mobilePhrase"></p>
                </div>
            </div>
        </section>

        <section class="text-center mb-5 pb-5">
            <button class="btn btn-light btn-lg shadow-lg px-5 rounded-pill fw-bold text-danger border border-2 border-danger mb-4" id="verCartaBtn">
                <i class="fas fa-envelope-open-text me-2"></i>Ver nuestra carta üíå
            </button>
            
            <div id="cartaContent" class="card mt-2 p-4 p-md-5 text-start mx-auto" style="display:none; max-width: 800px;">
                <div class="card-body">
                    <h3 class="card-title text-center text-danger fw-bold dancing-font display-5 mb-4">Mi amada Nini üåπ</h3>
                    <div class="fs-5 lh-lg" style="font-weight: 500;">
                        <p>Hoy celebramos <strong>2 a√±os y 2 meses</strong> de una historia maravillosa.</p>
                        <p>Desde el <strong>15 de diciembre de 2023</strong>, mi vida cambi√≥ para siempre. Eres mi refugio, mi mejor amiga y mi gran amor.</p>
                        <p>Gracias por ser como eres. Te amo con toda mi alma.</p>
                    </div>
                    <p class="text-end mt-5 fs-4 fw-bold text-danger dancing-font">Con todo mi amor,<br>Tu Til√≠n, Pedrito. ‚ù§Ô∏è</p>
                </div>
            </div>

            <div class="mt-5">
                <button id="loveButton" class="btn btn-danger btn-lg rounded-pill shadow-lg pulse-animation px-5 py-3 fs-4 fw-bold">
                    ¬°M√°s Magia! ‚ú®üòò
                </button>
            </div>
        </section>
    </main>

    <footer class="text-center py-4 text-white position-relative" style="z-index: 10;">
        <small class="opacity-75">Hecho con el alma ‚ù§Ô∏è por Pedrito para Nini &bull; 2026</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const CONFIG = {
                START_DATE: new Date('2023-12-15T00:00:00'),
                CAROUSEL: { 
                    INTERVAL: 3500, 
                    TOTAL_IMAGES: 100, // ACTUALIZADO A 100 FOTOS
                    IMAGE_PATH: './img/photo' 
                },
                PHRASES: [
                    "Eres la raz√≥n por la que sonr√≠o cada d√≠a.", "Tu amor llena mi vida de colores vivos.", 
                    "Cada momento contigo es un regalo.", "Eres mi sol constante en d√≠as grises.", 
                    "Tu risa es mi melod√≠a favorita.", "A tu lado, el mundo es perfecto.",
                    "Eres mi hoy, mi ma√±ana y mi siempre.", "Amo cada peque√±o detalle de ti.", 
                    "Gracias por ser mi paz y mi fuerza.", "Nuestra historia de amor es mi favorita."
                ],
                // ACTUALIZADO A 30 CANCIONES
                SONGS: Array.from({length: 30}, (_, i) => `audio/cancion${i+1}.mp3`)
            };

            // --- 1. CONTADOR ---
            function actualizarContador() {
                const now = new Date();
                const startDate = CONFIG.START_DATE;
                let years = now.getFullYear() - startDate.getFullYear();
                let months = now.getMonth() - startDate.getMonth();
                let days = now.getDate() - startDate.getDate();
                if (days < 0) { months--; const lastMonth = new Date(now.getFullYear(), now.getMonth(), 0); days += lastMonth.getDate(); }
                if (months < 0) { years--; months += 12; }
                const diff = now - startDate;
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);

                document.getElementById('contador-amor').innerHTML = `
                    <div class="time-box"><span class="time-val">${years}</span><span class="time-label">A√±os</span></div>
                    <div class="time-box"><span class="time-val">${months}</span><span class="time-label">Meses</span></div>
                    <div class="time-box"><span class="time-val">${days}</span><span class="time-label">D√≠as</span></div>
                    <div class="time-box"><span class="time-val">${h}</span><span class="time-label">Hrs</span></div>
                    <div class="time-box"><span class="time-val">${m}</span><span class="time-label">Min</span></div>
                    <div class="time-box"><span class="time-val">${s}</span><span class="time-label">Seg</span></div>
                `;
            }
            setInterval(actualizarContador, 1000);
            actualizarContador();

            // --- 2. M√öSICA CON ALEATORIO Y REPETIR ---
            const audio = document.getElementById('backgroundMusic');
            const playBtn = document.getElementById('playPauseButton');
            const shuffleBtn = document.getElementById('shuffleButton');
            const repeatBtn = document.getElementById('repeatButton');
            
            let currentSong = 0;
            let isPlaying = false;
            let isShuffle = false;
            let isRepeat = false;

            function loadSong(idx) {
                audio.src = CONFIG.SONGS[idx];
                audio.load();
                document.getElementById('songTitle').innerHTML = `<i class="fas fa-music text-danger"></i> Canci√≥n ${idx + 1}`;
            }

            function togglePlay() {
                if(!audio.src) loadSong(0);
                if(audio.paused) {
                    audio.play().then(() => {
                        isPlaying = true;
                        playBtn.innerHTML = `<i class="fas fa-pause"></i>`;
                        playBtn.classList.remove('pulse-animation');
                    });
                } else {
                    audio.pause();
                    isPlaying = false;
                    playBtn.innerHTML = `<i class="fas fa-play"></i>`;
                    playBtn.classList.add('pulse-animation');
                }
            }

            // L√≥gica Aleatorio
            shuffleBtn.onclick = () => {
                isShuffle = !isShuffle;
                shuffleBtn.classList.toggle('btn-active-control');
                shuffleBtn.classList.toggle('btn-outline-secondary');
            };

            // L√≥gica Repetir (Bucle de 1 canci√≥n)
            repeatBtn.onclick = () => {
                isRepeat = !isRepeat;
                audio.loop = isRepeat; // Habilita loop nativo de HTML5
                repeatBtn.classList.toggle('btn-active-control');
                repeatBtn.classList.toggle('btn-outline-secondary');
            };

            // Siguiente Canci√≥n (Manual o Autom√°tica)
            const nextSong = () => {
                if(isRepeat) {
                    // Si est√° en repetir y se pulsa next manual, forzamos la siguiente
                    // Si es autom√°tico, el 'audio.loop' ya se encarga de no llamar a esta funci√≥n
                    audio.currentTime = 0;
                    if(isPlaying) audio.play();
                } else {
                    if (isShuffle) {
                        // Elegir una al azar que no sea la actual (si hay m√°s de 1)
                        let newIndex = currentSong;
                        while(newIndex === currentSong && CONFIG.SONGS.length > 1) {
                            newIndex = Math.floor(Math.random() * CONFIG.SONGS.length);
                        }
                        currentSong = newIndex;
                    } else {
                        currentSong = (currentSong + 1) % CONFIG.SONGS.length;
                    }
                    loadSong(currentSong);
                    if(isPlaying) audio.play();
                }
            };

            playBtn.onclick = togglePlay;
            document.getElementById('nextButton').onclick = nextSong;
            
            document.getElementById('prevButton').onclick = () => {
                if(audio.currentTime > 3) {
                    audio.currentTime = 0; // Volver al inicio si ya avanz√≥
                } else {
                    currentSong = (currentSong - 1 + CONFIG.SONGS.length) % CONFIG.SONGS.length;
                    loadSong(currentSong);
                    if(isPlaying) audio.play();
                }
            };
            
            document.getElementById('volumeControl').oninput = (e) => audio.volume = e.target.value;
            
            // Evento al terminar canci√≥n
            audio.onended = () => {
                if (!isRepeat) nextSong(); // Solo pasa a la siguiente si no est√° en bucle
            };

            // --- 3. CARRUSEL ---
            const container = document.getElementById('carouselContainer');
            const ids = Array.from({length: CONFIG.CAROUSEL.TOTAL_IMAGES}, (_, i) => i + 1).sort(() => Math.random() - 0.5);
            ids.forEach((n, i) => {
                const div = document.createElement('div');
                div.className = `carousel-item ${i === 0 ? 'active' : ''}`;
                const loadingMode = i < 2 ? "eager" : "lazy";
                div.innerHTML = `<img src="${CONFIG.CAROUSEL.IMAGE_PATH}${n}.jpg" class="d-block" alt="Foto" loading="${loadingMode}" decoding="async" onerror="this.parentElement.remove()">`;
                container.appendChild(div);
            });

            let phraseIdx = 0;
            const updatePhrase = () => {
                const p = CONFIG.PHRASES[phraseIdx];
                document.getElementById('carouselPhrase').textContent = p;
                document.getElementById('mobilePhrase').textContent = p;
                phraseIdx = (phraseIdx + 1) % CONFIG.PHRASES.length;
            };
            document.getElementById('photoCarousel').addEventListener('slide.bs.carousel', updatePhrase);
            updatePhrase();

            // --- 4. FLOTANTES ---
            function createFloatingElement() {
                if(document.querySelectorAll('.floating-element').length > 12) return;
                const el = document.createElement('div');
                el.classList.add('floating-element');
                const symbols = ['‚ù§', 'üíñ', 'üíï', 'ü¶ã', '‚ú®', 'üåπ']; 
                el.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
                el.style.left = Math.random() * 95 + 'vw';
                el.style.animationDuration = (Math.random() * 5 + 8) + 's';
                el.style.fontSize = (Math.random() * 20 + 20) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 13000);
            }
            setInterval(createFloatingElement, 900);

            // --- 5. LOGIN ---
            const lBtn = document.getElementById('loginBtn');
            const pInp = document.getElementById('passwordInput');
            const lScr = document.getElementById('loginScreen');
            const mainC = document.getElementById('mainContent');

            const login = () => {
                if(pInp.value === "1512") {
                    lScr.classList.add('login-hidden');
                    mainC.style.display = 'block';
                    setTimeout(() => {
                        mainC.style.opacity = '1';
                        lScr.remove();
                        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                        togglePlay(); // Auto-play
                    }, 500);
                } else {
                    document.getElementById('errorMsg').style.display = 'block';
                    pInp.value = "";
                    if(navigator.vibrate) navigator.vibrate(200);
                }
            };
            lBtn.onclick = login;
            pInp.onkeypress = (e) => { if(e.key === 'Enter') login(); };
            setTimeout(() => pInp.focus(), 500);

            // --- 6. EXTRAS ---
            document.getElementById('verCartaBtn').onclick = function() {
                const c = document.getElementById('cartaContent');
                if (c.style.display === 'none') {
                    c.style.display = 'block';
                    this.innerHTML = '<i class="fas fa-eye-slash me-2"></i>Ocultar carta';
                    c.scrollIntoView({ behavior: 'smooth' });
                } else {
                    c.style.display = 'none';
                    this.innerHTML = '<i class="fas fa-envelope-open-text me-2"></i>Ver nuestra carta üíå';
                }
            };

            document.getElementById('loveButton').onclick = () => {
                confetti({ particleCount: 80, spread: 100, shapes: ['heart'], colors: ['#ff0a54', '#ff477e'], origin: { y: 0.6 } });
                setTimeout(() => {
                    confetti({ particleCount: 40, spread: 60, scalar: 3, shapes: ['emoji'], shapeOptions: { emoji: { value: ['üòò', 'üíã'] } }, origin: { y: 0.6 } });
                }, 300);
            };
        });
    </script>
</body>
</html>
