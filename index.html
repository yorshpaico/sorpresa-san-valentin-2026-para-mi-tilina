<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Para Nini - 2 A√±os y 2 Meses üíñ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- Variables y Temas --- */
        :root {
            --primary: #ff3366;       /* Rosa vibrante principal */
            --secondary: #ff6b8b;     /* Rosa secundario m√°s suave */
            --accent: #ff0066;        /* Acento fucsia */
            --bg-warm: #fff0f5;       /* Fondo c√°lido claro */
            --text-dark: #4a4e69;     /* Texto oscuro */
            --glass-bg: rgba(255, 255, 255, 0.85); /* Efecto cristal */
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow-soft: 0 10px 30px rgba(255, 51, 102, 0.2); /* Sombra suave rosada */
            --shadow-strong: 0 15px 45px rgba(255, 0, 102, 0.3);
             /* Degradado de fondo rom√°ntico y din√°mico */
            --bg-gradient: linear-gradient(135deg, #fff0f5 0%, #ffe6ee 25%, #ffd1dc 50%, #ffc4d6 75%, #ffb3c6 100%);
        }

        /* --- Estilos Globales --- */
        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-gradient);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite; /* Animaci√≥n suave del fondo */
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden; /* Evitar scroll horizontal */
            position: relative;
        }

        /* Animaci√≥n del degradado de fondo */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* T√≠tulos con tipograf√≠a cursiva rom√°ntica */
        h1, h2, h3, .dancing-font {
            font-family: 'Dancing Script', cursive;
        }

        /* --- Pantalla de Login (Seguridad) --- */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-warm);
            /* Capa superior de brillos para el login */
            background-image: radial-gradient(circle at center, transparent 0%, var(--bg-warm) 70%), 
                              url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ff99cc' fill-opacity='0.2'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            z-index: 9999; /* Siempre encima */
            display: flex; align-items: center; justify-content: center;
            transition: all 0.8s ease-in-out; /* Transici√≥n suave al desaparecer */
        }

        .login-content {
            background: var(--glass-bg);
            backdrop-filter: blur(25px); /* Efecto de desenfoque trasero */
            -webkit-backdrop-filter: blur(25px);
            padding: 3.5rem;
            border-radius: 40px;
            box-shadow: var(--shadow-strong);
            border: 2px solid var(--glass-border);
            max-width: 450px; width: 90%;
            text-align: center;
            transform: translateY(0);
            transition: transform 0.5s ease;
        }
        /* Efecto de flotaci√≥n al pasar el mouse sobre el login */
        .login-content:hover { transform: translateY(-5px); }

        /* Clase para ocultar el login al entrar */
        .login-hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: scale(0.8) translateY(-50px); /* Efecto de reducci√≥n y subida */
        }

        .login-input {
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid #ffccd5;
            color: var(--primary);
            font-weight: bold;
            letter-spacing: 4px;
            transition: all 0.3s;
        }
        .login-input:focus {
            background: white;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 51, 102, 0.3);
        }

        /* --- Componentes de la P√°gina Principal --- */
        
        /* Cajas del Contador */
        .time-box {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 25px;
            box-shadow: var(--shadow-soft);
            text-align: center;
            min-width: 90px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Efecto rebote */
        }
        .time-box:hover { transform: translateY(-8px) scale(1.05); } /* Hover animado */
        .time-val { display: block; font-size: 2.5rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .time-label { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; color: var(--secondary); font-weight: 700; margin-top: 5px; }

        /* Reproductor de M√∫sica y Tarjeta */
        .music-player, .card-custom {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 35px;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--glass-border);
            transition: all 0.4s ease;
        }
        .music-player:hover, .card-custom:hover {
            box-shadow: var(--shadow-strong);
            transform: translateY(-5px);
        }

        /* Botones Personalizados */
        .btn-custom-primary {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none; color: white;
            box-shadow: 0 8px 20px rgba(255, 51, 102, 0.4);
            transition: all 0.3s ease;
        }
        .btn-custom-primary:hover {
            transform: scale(1.05) translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 51, 102, 0.5);
            color: white;
        }

        /* --- Carrusel --- */
        .carousel-container-custom {
            border-radius: 35px;
            overflow: hidden;
            box-shadow: var(--shadow-strong);
            border: 4px solid white;
            background: rgba(255,255,255,0.2);
            position: relative;
        }
        .carousel-inner {
            height: 60vh; /* Altura adaptable */
            min-height: 400px;
        }
        .carousel-item { height: 100%; transition: transform 1s ease-in-out, opacity 0.5s ease-in-out; }
        .carousel-item img {
            height: 100%; width: 100%;
            object-fit: contain; /* Ajustar imagen sin cortar */
            display: block; margin: 0 auto;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        }
        .carousel-caption-custom {
            background: rgba(255, 255, 255, 0.92);
            color: var(--text-dark);
            border-radius: 50px;
            padding: 15px 30px;
            bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 2px solid var(--secondary);
            backdrop-filter: blur(5px);
            max-width: 80%; margin: 0 auto;
            left: 10%; right: 10%;
        }

        /* --- Elementos Flotantes (Corazones, Mariposas, etc.) --- */
        .floating-element {
            position: fixed;
            pointer-events: none; /* No interfieren con clicks */
            z-index: 10; /* CAMBIADO: Ahora est√°n por encima de todo (menos el login) */
            animation: floatAnimation linear forwards;
            font-family: "Segoe UI Emoji", "Noto Color Emoji", sans-serif;
            /* Sombra blanca para que resalten sobre fondos oscuros/fotos */
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5)); 
            will-change: transform, opacity; /* Optimizaci√≥n de rendimiento */
        }

        /* Animaci√≥n de flotar hacia arriba y rotar */
        @keyframes floatAnimation {
            0% { transform: translateY(105vh) rotate(0deg) translateX(0); opacity: 0; }
            10% { opacity: 0.9; } /* Aparecen r√°pido */
            80% { opacity: 0.9; }
            100% { transform: translateY(-15vh) rotate(360deg) translateX(30px); opacity: 0; } /* Desaparecen arriba */
        }

        /* Animaci√≥n de pulso para botones importantes */
        .pulse-animation { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 51, 102, 0.7); }
            50% { transform: scale(1.08); box-shadow: 0 0 0 15px rgba(255, 51, 102, 0); }
        }

        /* --- Ajustes Responsivos (M√≥viles) --- */
        @media (max-width: 768px) {
            header h1 { font-size: 2.8rem; }
            .carousel-inner { height: 50vh; min-height: 320px; }
            .time-box { min-width: 75px; padding: 10px 12px; }
            .time-val { font-size: 1.8rem; }
            .login-content { padding: 2.5rem 2rem; }
            .carousel-caption-custom { width: 95%; left: 2.5%; right: 2.5%; padding: 10px 20px; bottom: 20px;}
             /* Ocultar caption en m√≥viles muy peque√±os si molesta */
            @media (max-height: 600px) { .carousel-caption-custom { display: none; } }
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-overlay">
        <div class="login-content">
            <div class="mb-4">
                <span style="font-size: 5.5rem; display: inline-block;" class="pulse-animation">üíñ</span>
            </div>
            <h2 class="mb-3 fw-bold dancing-font" style="color: var(--primary); font-size: 2.8rem;">Hola, Nini</h2>
            <p class="mb-4" style="font-size: 1.1rem; color: var(--text-dark);">Introduce nuestra fecha especial (DDMM) para entrar a tu sorpresa:</p>
            
            <div class="d-flex justify-content-center gap-2 mb-3 mx-auto" style="max-width: 320px;">
                <input type="password" id="passwordInput" class="form-control text-center fs-3 login-input rounded-pill py-2" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" autocomplete="off" inputmode="numeric" pattern="[0-9]*">
                <button id="loginBtn" class="btn btn-custom-primary btn-lg rounded-circle shadow-lg d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <p id="errorMsg" class="text-danger fw-bold mt-3" style="display:none; font-size: 0.95rem;">
                <i class="fas fa-circle-exclamation me-2"></i>Esa no es la fecha, mi amor. Intenta de nuevo. ü•∫
            </p>
        </div>
    </div>

    <main class="container py-4" style="max-width: 900px;">
        <header class="text-center py-5">
            <h1 class="display-3 fw-bold dancing-font" style="color: var(--primary); text-shadow: 2px 2px 4px rgba(255,255,255,0.5);">Feliz Aniversario, Mi Amor</h1>
            <p class="lead fw-light fs-4 mt-3" style="color: var(--text-dark);">2 A√±os y 2 Meses de pura magia a tu lado. ‚ú®</p>
            <div class="mt-2" style="color: var(--secondary); font-size: 0.9rem;">(Desde el 15 de Diciembre de 2023)</div>
        </header>

        <section class="mb-5 text-center">
            <div id="contador-amor" class="d-flex justify-content-center flex-wrap gap-3 gap-md-4 align-items-center">
                <div class="spinner-border text-danger" role="status"><span class="visually-hidden">Cargando...</span></div>
            </div>
        </section>

        <section id="musica" class="mb-5">
            <div class="music-player text-center p-4">
                <h5 class="mb-3 dancing-font fw-bold" style="color: var(--primary);"><i class="fas fa-music me-2"></i>Nuestra Playlist</h5>
                <h6 id="songTitle" class="mb-4 text-muted fst-italic text-truncate px-3">üéµ Dale play para escuchar...</h6>
                <audio id="backgroundMusic"></audio>
                
                <div class="controls d-flex justify-content-center align-items-center gap-3 mb-4">
                    <button id="shuffleButton" class="btn btn-outline-secondary btn-sm rounded-circle p-2" data-bs-toggle="tooltip" title="Aleatorio"><i class="fas fa-random"></i></button>
                    <button id="prevButton" class="btn btn-secondary btn-lg rounded-circle shadow-sm p-3" style="width: 50px; height: 50px;"><i class="fas fa-backward"></i></button>
                    <button id="playPauseButton" class="btn btn-custom-primary btn-lg rounded-circle shadow-lg pulse-animation p-4" style="width: 80px; height: 80px; font-size: 2rem;"><i class="fas fa-play ps-1"></i></button>
                    <button id="nextButton" class="btn btn-secondary btn-lg rounded-circle shadow-sm p-3" style="width: 50px; height: 50px;"><i class="fas fa-forward"></i></button>
                    <button id="repeatButton" class="btn btn-outline-secondary btn-sm rounded-circle p-2" data-bs-toggle="tooltip" title="Repetir"><i class="fas fa-redo"></i></button>
                </div>
                
                <div class="volume-control w-75 mx-auto d-flex align-items-center gap-3">
                    <i class="fas fa-volume-down text-muted"></i>
                    <input type="range" class="form-range" id="volumeControl" min="0" max="1" step="0.01" value="0.5" style="accent-color: var(--primary);">
                    <i class="fas fa-volume-up text-muted"></i>
                </div>
            </div>
        </section>

        <section id="carrusel" class="mb-5">
            <div class="carousel-container-custom shadow-lg">
                <div id="photoCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="false"> <div class="carousel-inner" id="carouselContainer">
                         <div class="carousel-item active d-flex align-items-center justify-content-center h-100">
                             <div class="spinner-grow text-danger" role="status"></div>
                        </div>
                    </div>
                    
                    <div class="carousel-caption-custom text-center fade-in">
                        <p id="carouselPhrase" class="h5 mb-0 dancing-font fw-bold">Cada momento contigo es un tesoro...</p>
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#photoCarousel" data-bs-slide="prev" style="opacity: 1;">
                        <span class="bg-white text-danger rounded-circle shadow p-3 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; opacity: 0.8;"><i class="fas fa-chevron-left fs-4"></i></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#photoCarousel" data-bs-slide="next" style="opacity: 1;">
                        <span class="bg-white text-danger rounded-circle shadow p-3 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; opacity: 0.8;"><i class="fas fa-chevron-right fs-4"></i></span>
                    </button>
                </div>
            </div>
        </section>

        <section class="text-center mb-5">
            <button class="btn btn-custom-primary btn-lg shadow px-5 rounded-pill fw-bold" id="verCartaBtn">
                <i class="fas fa-envelope me-2"></i>Ver nuestra carta de amor
            </button>
            <div id="cartaContent" class="card-custom mt-4 p-4 p-md-5 text-start mx-auto" style="display:none; max-width: 700px;">
                <div class="card-body">
                    <h2 class="text-center mb-4 dancing-font fw-bold" style="color: var(--primary);">Mi amada Nini üåπ</h2>
                    <div style="font-size: 1.15rem; line-height: 1.8;">
                        <p>Hoy se cumplen <strong>2 a√±os y 2 meses</strong> desde que empezamos este camino juntos, y te juro que cada d√≠a me enamoro m√°s de ti.</p>
                        <p>Desde aquel 15 de diciembre de 2023, trajiste una luz incre√≠ble a mi vida. Eres mi compa√±era, mi confidente, mi paz y mi refugio seguro.</p>
                        <p>Gracias por cada risa, por cada abrazo que reinicia mi mundo y por amarme exactamente como soy. No veo la hora de seguir sumando cap√≠tulos a esta historia tan nuestra.</p>
                        <p class="fw-bold" style="color: var(--accent);">Eres mi presente m√°s bonito y el futuro que siempre so√±√©. Te amo con toda mi alma.</p>
                    </div>
                    <div class="text-end mt-5">
                        <p class="fs-4 fw-bold dancing-font" style="color: var(--primary);">Siempre tuyo,<br>Tu Pedrito. ‚ù§Ô∏è</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="text-center mb-5 pb-4">
            <button id="loveButton" class="btn btn-custom-primary btn-lg rounded-pill shadow-lg pulse-animation px-5 py-3 fs-4 fw-bold">
                ¬°Toca para m√°s magia! ‚ú®üíñ
            </button>
        </div>
    </main>

    <footer class="text-center py-4 text-muted" style="background: rgba(255,255,255,0.4);">
        <small class="fw-bold">Hecho con todo el ‚ù§Ô∏è del mundo por Pedrito para Nini &bull; 2026</small>
    </footer>

    <div class="modal fade" id="welcomeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content card-custom text-center p-4 border-0">
                <div class="modal-body">
                    <h2 class="mb-3 dancing-font fw-bold" style="color: var(--primary); font-size: 2.5rem;">¬°Lo lograste, mi vida! üíò</h2>
                    <p class="fs-5 mb-4">He preparado este peque√±o rinc√≥n digital con mucho amor para celebrar nuestro d√≠a. Espero que te guste tanto como a m√≠ me gustas t√∫.</p>
                    <button type="button" class="btn btn-custom-primary btn-lg rounded-pill px-5 py-2 shadow-sm" data-bs-dismiss="modal">
                        <i class="fas fa-heart me-2"></i>Ver mi sorpresa üòç
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // --- CONFIGURACI√ìN PRINCIPAL ---
            const CONFIG = {
                START_DATE: new Date('2023-12-15T00:00:00'), // Fecha de inicio
                PASSWORD: "1512", // Contrase√±a de acceso
                CAROUSEL: { 
                    INTERVAL: 4000, // Tiempo entre fotos (ms)
                    // === ACTUALIZADO A 120 FOTOS ===
                    TOTAL_IMAGES: 120, 
                    IMAGE_PATH: './img/photo' // Ruta base de im√°genes
                },
                PHRASES: [
                    "Eres la raz√≥n de mis sonrisas diarias.", "Tu amor ilumina mi vida entera.", "Cada segundo contigo es un regalo.",
                    "Eres mi sol, mi luna y mis estrellas.", "Tu risa es mi melod√≠a favorita.", "Juntos, todo es mejor.",
                    "Eres mi hoy y todos mis ma√±anas.", "Amo cada detalle que te hace √∫nica.", "Gracias por ser mi paz y mi hogar.",
                    "Nuestra historia es mi cuento favorito."
                ],
                // === ACTUALIZADO A 40 CANCIONES ===
                SONGS: Array.from({length: 40}, (_, i) => `audio/cancion${i+1}.mp3`)
            };

            // Inicializar Tooltips de Bootstrap
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });

            // -----------------------------------------
            // 1. L√≥gica del Contador de Tiempo
            // -----------------------------------------
            function actualizarContador() {
                const now = new Date();
                const startDate = CONFIG.START_DATE;
                
                // C√°lculo preciso de a√±os, meses, d√≠as
                let years = now.getFullYear() - startDate.getFullYear();
                let months = now.getMonth() - startDate.getMonth();
                let days = now.getDate() - startDate.getDate();

                // Ajuste por si el d√≠a/mes actual es menor al de inicio
                if (days < 0) {
                    months--;
                    // Obtener d√≠as del mes anterior
                    const lastMonth = new Date(now.getFullYear(), now.getMonth(), 0);
                    days += lastMonth.getDate();
                }
                if (months < 0) {
                    years--;
                    months += 12;
                }

                // C√°lculo de horas, minutos, segundos usando timestamp
                const diff = now - startDate;
                const h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000);
                const s = Math.floor((diff % 60000) / 1000);

                // Funci√≥n helper para formatear a 2 d√≠gitos (01, 05, etc.)
                const fmt = (n) => n.toString().padStart(2, '0');

                // Inyectar HTML en el contenedor
                document.getElementById('contador-amor').innerHTML = `
                    <div class="time-box"><span class="time-val">${years}</span><span class="time-label">A√±os</span></div>
                    <div class="time-box"><span class="time-val">${months}</span><span class="time-label">Meses</span></div>
                    <div class="time-box"><span class="time-val">${fmt(days)}</span><span class="time-label">D√≠as</span></div>
                    <div class="time-box"><span class="time-val">${fmt(h)}</span><span class="time-label">Hrs</span></div>
                    <div class="time-box"><span class="time-val">${fmt(m)}</span><span class="time-label">Min</span></div>
                    <div class="time-box"><span class="time-val">${fmt(s)}</span><span class="time-label">Seg</span></div>
                `;
            }
            // Actualizar cada segundo e iniciar inmediatamente
            setInterval(actualizarContador, 1000);
            actualizarContador();

            // -----------------------------------------
            // 2. L√≥gica del Reproductor de M√∫sica
            // -----------------------------------------
            const audio = document.getElementById('backgroundMusic');
            const playBtn = document.getElementById('playPauseButton');
            const titleDisplay = document.getElementById('songTitle');
            let currentSongIdx = 0;
            let isPlaying = false;
            let isShuffle = false;
            let isRepeat = false;

            // Funci√≥n para cargar una canci√≥n
            function loadSong(idx) {
                currentSongIdx = idx;
                audio.src = CONFIG.SONGS[currentSongIdx];
                titleDisplay.textContent = `üéµ Reproduciendo: Canci√≥n ${currentSongIdx + 1}`;
                // Efecto visual de cambio
                titleDisplay.style.opacity = 0;
                setTimeout(() => titleDisplay.style.opacity = 1, 200);
            }

            // Funci√≥n para reproducir/pausar
            function togglePlay() {
                if(!audio.src || audio.ended) loadSong(currentSongIdx);
                
                if(audio.paused) {
                    audio.play().then(() => {
                        isPlaying = true;
                        updatePlayButton();
                    }).catch(e => console.log("Error reproducci√≥n:", e));
                } else {
                    audio.pause();
                    isPlaying = false;
                    updatePlayButton();
                }
            }

            // Actualizar icono del bot√≥n Play/Pause
            function updatePlayButton() {
                playBtn.innerHTML = isPlaying ? 
                    '<i class="fas fa-pause ps-0"></i>' : 
                    '<i class="fas fa-play ps-1"></i>';
                playBtn.classList.toggle('pulse-animation', !isPlaying);
            }

            // Funciones de navegaci√≥n (Siguiente/Anterior)
            function nextSong() {
                if(isShuffle) {
                    // Elegir canci√≥n aleatoria distinta a la actual
                    let newIdx;
                    do { newIdx = Math.floor(Math.random() * CONFIG.SONGS.length); } 
                    while (newIdx === currentSongIdx && CONFIG.SONGS.length > 1);
                    currentSongIdx = newIdx;
                } else {
                    currentSongIdx = (currentSongIdx + 1) % CONFIG.SONGS.length;
                }
                loadSong(currentSongIdx);
                if(isPlaying) audio.play();
            }

            function prevSong() {
                 // Si lleva m√°s de 3s reproduciendo, volver al inicio de la canci√≥n
                 if(audio.currentTime > 3) {
                    audio.currentTime = 0;
                } else {
                    // Si no, ir a la canci√≥n anterior
                    currentSongIdx = (currentSongIdx - 1 + CONFIG.SONGS.length) % CONFIG.SONGS.length;
                    loadSong(currentSongIdx);
                }
                if(isPlaying) audio.play();
            }

            // Event Listeners del Reproductor
            playBtn.onclick = togglePlay;
            document.getElementById('nextButton').onclick = nextSong;
            document.getElementById('prevButton').onclick = prevSong;
            
            document.getElementById('volumeControl').oninput = (e) => {
                audio.volume = e.target.value;
                // Cambiar icono de volumen seg√∫n nivel
                const iconDown = document.querySelector('.fa-volume-down');
                 if(audio.volume === 0) iconDown.className = 'fas fa-volume-mute text-muted';
                 else if(audio.volume < 0.5) iconDown.className = 'fas fa-volume-down text-muted';
                 else iconDown.className = 'fas fa-volume-up text-muted';
            };

            // Comportamiento al terminar canci√≥n
            audio.onended = () => {
                if(isRepeat) {
                    audio.currentTime = 0;
                    audio.play();
                } else {
                    nextSong();
                }
            };

            // Botones Shuffle y Repeat
            document.getElementById('shuffleButton').onclick = function() {
                isShuffle = !isShuffle;
                this.classList.toggle('btn-custom-primary', isShuffle);
                this.classList.toggle('btn-outline-secondary', !isShuffle);
                if(isShuffle && !isPlaying) nextSong(); // Empezar si se activa shuffle
            };

            document.getElementById('repeatButton').onclick = function() {
                isRepeat = !isRepeat;
                this.classList.toggle('btn-custom-primary', isRepeat);
                this.classList.toggle('btn-outline-secondary', !isRepeat);
                // Mostrar peque√±o indicador de modo repetici√≥n
                titleDisplay.textContent = isRepeat ? `üîÇ Repitiendo: Canci√≥n ${currentSongIdx + 1}` : `üéµ Reproduciendo: Canci√≥n ${currentSongIdx + 1}`;
            };


            // -----------------------------------------
            // 3. L√≥gica del Carrusel de Fotos
            // -----------------------------------------
            const carouselContainer = document.getElementById('carouselContainer');
            const carouselElement = document.getElementById('photoCarousel');
            const carouselPhrase = document.getElementById('carouselPhrase');

            // Limpiar contenedor inicial (quitando el spinner)
            carouselContainer.innerHTML = '';

            // Generar array de √≠ndices [1, 2, ... TOTAL_IMAGES]
            const imageIndices = Array.from({length: CONFIG.CAROUSEL.TOTAL_IMAGES}, (_, i) => i + 1);
            
            // Mezclar aleatoriamente los √≠ndices (Fisher-Yates shuffle simplificado)
            imageIndices.sort(() => Math.random() - 0.5);

            // Crear los elementos del carrusel
            imageIndices.forEach((num, index) => {
                const div = document.createElement('div');
                // El primer elemento debe ser 'active'
                div.className = `carousel-item h-100 ${index === 0 ? 'active' : ''}`;
                
                // Usar loading="lazy" para rendimiento y ondragstart="return false" para evitar arrastrar imagen
                div.innerHTML = `
                    <img src="${CONFIG.CAROUSEL.IMAGE_PATH}${num}.jpg" 
                         class="d-block w-100 h-100" 
                         alt="Recuerdo ${num}" 
                         loading="lazy" 
                         ondragstart="return false"
                         onerror="this.closest('.carousel-item').remove()"> `;
                carouselContainer.appendChild(div);
            });

            // Inicializar carrusel de Bootstrap con opciones
            const carousel = new bootstrap.Carousel(carouselElement, {
                interval: CONFIG.CAROUSEL.INTERVAL,
                wrap: true,
                pause: 'hover' // Pausar si se pasa el mouse por encima
            });

            // Cambiar frases en cada transici√≥n del carrusel
            let currentPhraseIndex = 0;
            carouselElement.addEventListener('slide.bs.carousel', () => {
                // Efecto de desvanecimiento para el texto
                carouselPhrase.style.opacity = 0;
                setTimeout(() => {
                    currentPhraseIndex = (currentPhraseIndex + 1) % CONFIG.PHRASES.length;
                    carouselPhrase.textContent = CONFIG.PHRASES[currentPhraseIndex];
                    carouselPhrase.style.opacity = 1;
                }, 300); // Coincide con mitad de transici√≥n CSS
            });


            // -----------------------------------------
            // 4. Elementos Flotantes (Corazones/Mariposas) - MEJORADO
            // -----------------------------------------
            function createFloatingElement() {
                const el = document.createElement('div');
                el.classList.add('floating-element');
                // S√≠mbolos rom√°nticos variados
                const symbols = ['‚ù§', 'üíñ', 'üíï', 'üíó', 'üíì', 'ü¶ã', '‚ú®', 'üå∏'];
                el.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
                
                // Posici√≥n horizontal aleatoria
                el.style.left = Math.random() * 95 + 'vw';
                
                // --- CAMBIOS AQU√ç PARA HACERLOS M√ÅS GRANDES Y DIN√ÅMICOS ---
                // Duraci√≥n de la animaci√≥n entre 6s y 13s (m√°s lenta si son grandes)
                const duration = Math.random() * 7 + 6;
                el.style.animationDuration = duration + 's';
                
                // Tama√±o entre 25px y 55px (mucho m√°s grandes que antes)
                const size = Math.random() * 30 + 25;
                el.style.fontSize = size + 'px';
                
                // Opacidad variable
                el.style.opacity = Math.random() * 0.6 + 0.4; 
                
                document.body.appendChild(el);
                
                // Eliminar elemento al terminar su animaci√≥n para no saturar la memoria
                setTimeout(() => {
                    if(document.body.contains(el)) el.remove();
                }, duration * 1000 + 100);
            }
            
            // --- CAMBIO DE FRECUENCIA ---
            // Generar elementos cada 250ms (4 por segundo) en lugar de 500ms
            // Esto hace la p√°gina mucho m√°s din√°mica
            setInterval(createFloatingElement, 250); 
            // Crear algunos iniciales de golpe
            for(let i=0; i<10; i++) setTimeout(createFloatingElement, i*100);

            // -----------------------------------------
            // 5. L√≥gica de Acceso (Login)
            // -----------------------------------------
            const loginScreen = document.getElementById('loginScreen');
            const passwordInput = document.getElementById('passwordInput');
            const loginBtn = document.getElementById('loginBtn');
            const errorMsg = document.getElementById('errorMsg');
            const welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));

            function attemptLogin() {
                if(passwordInput.value === CONFIG.PASSWORD) {
                    // Login exitoso
                    errorMsg.style.display = 'none';
                    passwordInput.blur(); // Quitar foco (oculta teclado en m√≥vil)
                    
                    // Efecto de salida
                    loginScreen.classList.add('login-hidden');
                    
                    setTimeout(() => {
                        loginScreen.remove(); // Eliminar del DOM
                        welcomeModal.show(); // Mostrar modal de bienvenida
                        // Lanzar confeti de celebraci√≥n
                        confetti({ 
                            particleCount: 180, 
                            spread: 100, 
                            origin: { y: 0.6 },
                            colors: ['#ff3366', '#ff99cc', '#ffffff']
                        });
                        // Intentar iniciar m√∫sica autom√°ticamente (puede ser bloqueado por navegador)
                        playBtn.click(); 
                    }, 800); // Esperar a que termine la transici√≥n CSS
                } else {
                    // Login fallido
                    errorMsg.style.display = 'block';
                    // Efecto de vibraci√≥n/sacudida en el input
                    passwordInput.classList.add('is-invalid', 'animate__animated', 'animate__shakeX');
                    setTimeout(() => {
                         passwordInput.classList.remove('is-invalid', 'animate__animated', 'animate__shakeX');
                         passwordInput.value = '';
                         passwordInput.focus();
                    }, 800);
                }
            }

            // Eventos para el login
            loginBtn.onclick = attemptLogin;
            passwordInput.onkeypress = (e) => { 
                if(e.key === 'Enter') {
                    e.preventDefault(); // Evitar submit de formulario si lo hubiera
                    attemptLogin(); 
                }
            };
            // Enfocar input al cargar (√∫til en desktop)
            setTimeout(() => passwordInput.focus(), 500);

            // -----------------------------------------
            // 6. Interacciones Adicionales
            // -----------------------------------------
            
            // Mostrar/Ocultar Carta
            const cartaBtn = document.getElementById('verCartaBtn');
            const cartaContent = document.getElementById('cartaContent');
            cartaBtn.onclick = function() {
                // Verificar si est√° visible comprobando el estilo display
                const isHidden = window.getComputedStyle(cartaContent).display === 'none';
                
                if(isHidden) {
                    cartaContent.style.display = 'block';
                    // Peque√±o timeout para permitir que el navegador renderice el bloque antes de animar la opacidad
                    setTimeout(() => {
                        cartaContent.classList.add('fade-in'); 
                        this.innerHTML = '<i class="fas fa-eye-slash me-2"></i>Ocultar carta üôà';
                        // Scroll suave hacia la carta
                        cartaContent.scrollIntoView({behavior: 'smooth', block: 'start'});
                    }, 10);
                } else {
                    cartaContent.classList.remove('fade-in');
                    // Esperar a que termine la transici√≥n de opacidad (si la hubiera) para ocultar
                    setTimeout(() => {
                         cartaContent.style.display = 'none';
                         this.innerHTML = '<i class="fas fa-envelope me-2"></i>Ver nuestra carta de amor üíå';
                    }, 300);
                }
            };

            // Bot√≥n de Magia Final (Lanza confeti de corazones)
            document.getElementById('loveButton').onclick = function() {
                // Animaci√≥n del bot√≥n al hacer click
                this.classList.remove('pulse-animation');
                void this.offsetWidth; // Forzar reflow
                this.classList.add('pulse-animation');

                confetti({ 
                    particleCount: 80, 
                    spread: 180, 
                    origin: { y: 0.8 },
                    shapes: ['heart'], 
                    colors: ['#ff3366', '#ff0066', '#ffffff'],
                    scalar: 2 // Corazones m√°s grandes
                });
                 // Segunda explosi√≥n peque√±a un poco despu√©s
                setTimeout(() => {
                     confetti({ particleCount: 40, spread: 100, origin: { y: 0.7 }, shapes: ['heart'], colors: ['#ff99cc'] });
                }, 400);
            };
        });
    </script>
</body>
</html>
